{% extends "base.html" %}

{% block body_class %}invitations-page{% endblock %}

{% block title %}Team Invitations - Postly{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/invitations.css') }}">
{% endblock %}

{% block content %}
<div class="invitations-shell">
    <span class="invitation-orb orb-one"></span>
    <span class="invitation-orb orb-two"></span>
    <div class="invitations-container">
        <header class="invitations-hero" aria-label="Pending invitations header">
            <div class="hero-main">
                <p class="hero-eyebrow">Team invitations</p>
                <h1>Pending approvals</h1>
                <p class="hero-subtitle">Review who can access your workspace and respond in one place.</p>
            </div>
            <div class="hero-stats">
                <div class="hero-chip">
                    <span>Pending</span>
                    <strong>{% if invitations %}{{ invitations|length }}{% else %}0{% endif %}</strong>
                </div>
                <div class="hero-chip">
                    <span>Last update</span>
                    <strong>{{ (invitations[0].created_at.strftime('%b %d, %Y') if invitations) or 'Just now' }}</strong>
                </div>
            </div>
        </header>

        {% if invitations %}
        <div class="invitation-list" aria-label="Pending invitations list">
            {% for invitation in invitations %}
            <article class="invitation-card glass-panel">
                <header class="invitation-card-header">
                    <div class="invitation-card-title">
                        <div class="invitation-badge">{{ invitation.team_obj.name[:1]|upper if invitation.team_obj.name else '?' }}</div>
                        <div>
                            <p class="invitation-eyebrow">Team</p>
                            <h2>{{ invitation.team_obj.name }}</h2>
                            <div class="invitation-meta">
                                <span><i class="fas fa-user"></i>Invited by <strong>{{ invitation.inviter_name }}</strong></span>
                                <span><i class="fas fa-clock"></i>{{ invitation.created_at.strftime('%B %d, %Y') }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="invitation-pill">
                        <span>{{ invitation.role }}</span>
                    </div>
                </header>

                <div class="invitation-permissions">
                    <p class="permissions-label">You'll be able to:</p>
                    <ul class="permission-list">
                        {% if invitation.role == 'admin' %}
                        <li><i class="fas fa-user-plus"></i>Invite and manage members</li>
                        <li><i class="fas fa-shield-alt"></i>Assign channel permissions</li>
                        <li><i class="fas fa-check-circle"></i>Approve team posts</li>
                        <li><i class="fas fa-sliders-h"></i>Configure team settings</li>
                        {% else %}
                        <li><i class="fas fa-calendar-plus"></i>Create & schedule posts</li>
                        <li><i class="fas fa-paper-plane"></i>Request approvals</li>
                        <li><i class="fas fa-chart-line"></i>View performance analytics</li>
                        <li><i class="fas fa-people-arrows"></i>Collaborate with teammates</li>
                        {% endif %}
                    </ul>
                </div>

                <footer class="invitation-card-footer">
                    <div class="invitation-timestamps">
                        <span class="timestamp-chip">
                            <i class="fas fa-clock"></i>
                            Invited {{ invitation.created_at.strftime('%B %d, %Y') }}
                        </span>
                        {% if invitation.expires_at %}
                        <span class="timestamp-chip">
                            <i class="fas fa-hourglass-end"></i>
                            Expires {{ invitation.expires_at.strftime('%B %d, %Y') }}
                        </span>
                        {% endif %}
                    </div>
                    <div class="invitation-actions">
                        <a class="invitation-btn invitation-btn-primary" href="{{ url_for('team_accept_invite', token=invitation.invitation_token) }}">
                            <i class="fas fa-check"></i>Accept
                        </a>
                        <form action="{{ url_for('team_decline_invite', token=invitation.invitation_token) }}" method="POST">
                            <button type="submit" class="invitation-btn invitation-btn-ghost">
                                <i class="fas fa-times"></i>Decline
                            </button>
                        </form>
                    </div>
                </footer>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <section class="glass-panel invitations-empty">
            <div class="empty-icon">
                <i class="fas fa-inbox"></i>
            </div>
            <h3>No pending invitations</h3>
            <p>Everything is up to date. Weâ€™ll let you know when a teammate invites you.</p>
            <a href="{{ url_for('team_dashboard') }}" class="invitation-btn invitation-btn-primary">
                <i class="fas fa-arrow-left"></i>Back to Team
            </a>
        </section>
        {% endif %}
    </div>
</div>
{% endblock %}
