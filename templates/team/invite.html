{% extends "base.html" %}

{% block body_class %}team-page team-invite-page{% endblock %}

{% block title %}Invite Member - Postly Team{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/team.css') }}">
{% endblock %}

{% block content %}
<div class="team-dashboard invite-dashboard">
    <span class="team-orb orb-one"></span>
    <span class="team-orb orb-two"></span>
    <div class="team-dashboard-inner">
        <header class="team-hero-header invite-hero" aria-label="Send a team invitation">
            <div class="hero-row">
                <div class="hero-main">
                    <p class="hero-eyebrow">Team invitation</p>
                    <h1>Invite someone to {{ team.name }}</h1>
                    <p class="hero-subtitle">Give collaborators the same Publish-ready space so they can plan and ship work with you.</p>
                </div>
                <div class="hero-actions">
                    <a href="{{ url_for('team_dashboard', team_id=team.id) }}" class="team-btn team-btn-ghost">
                        <i class="fas fa-arrow-left"></i>
                        Back to team
                    </a>
                </div>
            </div>
            <div class="hero-stats">
                <div class="hero-chip">
                    <span>Members</span>
                    <strong>{{ team.members|length + 1 }}</strong>
                </div>
                <div class="hero-chip">
                    <span>Owner</span>
                    <strong>{{ team.owner.username if team.owner else 'Owner' }}</strong>
                </div>
            </div>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages" role="status" aria-live="polite">
            {% for category, message in messages %}
            <div class="flash flash-{{ category }}">
                <i class="fas {% if category == 'success' %}fa-check-circle{% elif category == 'warning' %}fa-exclamation-triangle{% else %}fa-circle-info{% endif %}"></i>
                <span>{{ message }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <form method="POST" action="{{ url_for('team_invite', team_id=team.id) }}" class="invite-flow">
            <section class="glass-panel invite-panel invite-panel-single">
                <div class="panel-heading">
                    <p class="panel-eyebrow">Invitation details</p>
                    <h2>Everything in one place</h2>
                    <p class="panel-subtitle">Add who you're inviting, decide how they work with you, and preview the permissions before sending.</p>
                </div>

                <div class="field-stack">
                    <div class="field-group">
                        <label for="invited_name" class="field-label">Full name</label>
                        <input type="text"
                               class="field-input"
                               id="invited_name"
                               name="invited_name"
                               required
                               placeholder="Alex Doe"
                               minlength="2"
                               maxlength="255">
                        <p class="field-hint">Shown inside the workspace whenever they collaborate.</p>
                    </div>
                    <div class="field-group">
                        <label for="invited_email" class="field-label">Email address</label>
                        <input type="email"
                               class="field-input"
                               id="invited_email"
                               name="invited_email"
                               required
                               placeholder="alex@example.com">
                        <p class="field-hint">We'll send the secure invitation link here. Double-check it if we notify you of a typo.</p>
                    </div>
                </div>

                <div class="panel-divider" role="presentation"></div>

                <div class="form-section">
                    <div class="panel-heading compact">
                        <p class="panel-eyebrow">Role & access</p>
                        <h3>Choose how they contribute</h3>
                    </div>
                    <input type="hidden" name="role" id="role-input" value="member">
                    <div class="role-cards" role="radiogroup" aria-label="Invite role">
                        <button type="button" class="role-card active" data-role="member" aria-pressed="true">
                            <div class="role-card-title">Member</div>
                            <p class="role-card-desc">Create and refine posts, request approvals, and collaborate within assigned channels.</p>
                        </button>
                        <button type="button" class="role-card" data-role="admin" aria-pressed="false">
                            <div class="role-card-title">Admin</div>
                            <p class="role-card-desc">Everything a member can do plus invitations, approvals, and workspace settings.</p>
                        </button>
                    </div>
                </div>

                <div class="panel-divider" role="presentation"></div>

                <div class="form-section permissions-panel">
                    <div class="panel-heading compact">
                        <p class="panel-eyebrow">Permissions</p>
                        <h3>Preview capabilities</h3>
                    </div>
                    <div class="permissions-header">
                        <i class="fas fa-shield-alt"></i>
                        <div>
                            <p class="permissions-label" id="permissions-role-title">Member permissions</p>
                            <p class="permissions-subtext">These adjust automatically based on the role you picked above.</p>
                        </div>
                    </div>
                    <div class="permissions-wrapper">
                        <div id="member-permissions" class="permission-list">
                            <div class="permission-item">
                                <span class="permission-icon allowed"><i class="fas fa-check"></i></span>
                                <div>
                                    <p class="permission-title">Create and schedule posts</p>
                                    <p class="permission-hint">Channel-level access still applies.</p>
                                </div>
                            </div>
                            <div class="permission-item">
                                <span class="permission-icon allowed"><i class="fas fa-check"></i></span>
                                <div>
                                    <p class="permission-title">Request approvals</p>
                                    <p class="permission-hint">Keep workflows organized when channels require review.</p>
                                </div>
                            </div>
                            <div class="permission-item">
                                <span class="permission-icon allowed"><i class="fas fa-check"></i></span>
                                <div>
                                    <p class="permission-title">View analytics</p>
                                    <p class="permission-hint">Read-only analytics access for their assigned channels.</p>
                                </div>
                            </div>
                            <div class="permission-item">
                                <span class="permission-icon denied"><i class="fas fa-times"></i></span>
                                <div>
                                    <p class="permission-title">Invite teammates</p>
                                    <p class="permission-hint">Only admins can add or remove people.</p>
                                </div>
                            </div>
                            <div class="permission-item">
                                <span class="permission-icon denied"><i class="fas fa-times"></i></span>
                                <div>
                                    <p class="permission-title">Manage members</p>
                                    <p class="permission-hint">Role changes and removals are admin-only.</p>
                                </div>
                            </div>
                            <div class="permission-item">
                                <span class="permission-icon denied"><i class="fas fa-times"></i></span>
                                <div>
                                    <p class="permission-title">Edit team settings</p>
                                    <p class="permission-hint">Brand + workflow settings remain protected.</p>
                                </div>
                            </div>
                        </div>
                        <div id="admin-permissions" class="permission-list" hidden>
                            <div class="permission-item">
                                <span class="permission-icon allowed"><i class="fas fa-check"></i></span>
                                <div>
                                    <p class="permission-title">Plan and publish everywhere</p>
                                    <p class="permission-hint">Full channel access for the team.</p>
                                </div>
                            </div>
                            <div class="permission-item">
                                <span class="permission-icon allowed"><i class="fas fa-check"></i></span>
                                <div>
                                    <p class="permission-title">Invite and manage teammates</p>
                                    <p class="permission-hint">Send invites, revoke access, and update roles.</p>
                                </div>
                            </div>
                            <div class="permission-item">
                                <span class="permission-icon allowed"><i class="fas fa-check"></i></span>
                                <div>
                                    <p class="permission-title">Approve scheduled posts</p>
                                    <p class="permission-hint">Keep workflows moving for channels that require approval.</p>
                                </div>
                            </div>
                            <div class="permission-item">
                                <span class="permission-icon allowed"><i class="fas fa-check"></i></span>
                                <div>
                                    <p class="permission-title">Manage channel permissions</p>
                                    <p class="permission-hint">Grant or revoke access for specific members.</p>
                                </div>
                            </div>
                            <div class="permission-item">
                                <span class="permission-icon allowed"><i class="fas fa-check"></i></span>
                                <div>
                                    <p class="permission-title">Deep-dive analytics</p>
                                    <p class="permission-hint">See every channel report and export insights.</p>
                                </div>
                            </div>
                            <div class="permission-item">
                                <span class="permission-icon allowed"><i class="fas fa-check"></i></span>
                                <div>
                                    <p class="permission-title">Update team settings</p>
                                    <p class="permission-hint">Brand presets, workflows, and integrations.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <div class="invite-actions">
                <a href="{{ url_for('team_dashboard', team_id=team.id) }}" class="team-btn team-btn-ghost">
                    <i class="fas fa-times"></i>
                    Cancel
                </a>
                <button type="submit" class="team-btn team-btn-primary">
                    <i class="fas fa-paper-plane"></i>
                    Send invitation
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const roleInput = document.getElementById('role-input');
    const memberPerms = document.getElementById('member-permissions');
    const adminPerms = document.getElementById('admin-permissions');
    const permissionsTitle = document.getElementById('permissions-role-title');
    const roleCards = document.querySelectorAll('.role-card');

    function syncRoleUI(role) {
        const isAdmin = role === 'admin';
        memberPerms.hidden = isAdmin;
        adminPerms.hidden = !isAdmin;
        permissionsTitle.textContent = isAdmin ? 'Admin permissions' : 'Member permissions';
        roleCards.forEach((card) => {
            card.classList.toggle('active', card.dataset.role === role);
            card.setAttribute('aria-pressed', card.dataset.role === role);
        });
    }

    roleCards.forEach((card) => {
        card.addEventListener('click', () => {
            const role = card.dataset.role;
            roleInput.value = role;
            syncRoleUI(role);
        });
    });

    syncRoleUI(roleInput.value);
</script>
{% endblock %}
